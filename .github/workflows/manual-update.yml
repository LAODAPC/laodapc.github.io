name: Manual Update Stats

on:
  workflow_dispatch:
    inputs:
      followers:
        description: 'æŠ–éŸ³ç²‰ä¸æ•°é‡'
        required: true
        type: number
        default: 0
      likes:
        description: 'æŠ–éŸ³è·èµæ•°é‡'
        required: true
        type: number
        default: 0
      videos:
        description: 'æŠ–éŸ³ä½œå“æ•°é‡'
        required: true
        type: number
        default: 0

jobs:
  manual-update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.PAT }}
    
    - name: Update stats manually
      run: |
        mkdir -p data
        echo '{
          "followers": ${{ github.event.inputs.followers }},
          "likes": ${{ github.event.inputs.likes }},
          "videos": ${{ github.event.inputs.videos }},
          "lastUpdate": "'"$(date +"%Y-%m-%d %H:%M:%S")"'",
          "status": "manual_update",
          "source": "manual_input"
        }' > data/stats.json
        echo "æ›´æ–°åçš„æ•°æ®:"
        cat data/stats.json
    
    - name: Commit changes
      run: |
        git config user.email "action@github.com"
        git config user.name "GitHub Action"
        git add data/stats.json
        git commit -m "ğŸ“Š æ‰‹åŠ¨æ›´æ–°: ç²‰ä¸ ${{ github.event.inputs.followers }} | è·èµ ${{ github.event.inputs.likes }} | ä½œå“ ${{ github.event.inputs.videos }}"
        git push
