name: Debug Data Update

on:
  workflow_dispatch:

jobs:
  debug-update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.PAT }}
    
    - name: Debug Current State
      run: |
        echo "=== è°ƒè¯•å¼€å§‹ ==="
        echo "å½“å‰ç›®å½•:"
        pwd
        ls -la
        echo "dataç›®å½•å†…å®¹:"
        ls -la data/ || echo "dataç›®å½•ä¸å­˜åœ¨"
        echo "å½“å‰stats.jsonå†…å®¹:"
        cat data/stats.json || echo "æ–‡ä»¶ä¸å­˜åœ¨"
        echo "=== è°ƒè¯•ç»“æŸ ==="
    
    - name: Force Write New Data
      run: |
        echo "=== å¼ºåˆ¶å†™å…¥æ–°æ•°æ® ==="
        # ç¡®ä¿ç›®å½•å­˜åœ¨
        mkdir -p data
        # å¼ºåˆ¶å†™å…¥å…¨æ–°æ•°æ®ï¼ˆå¸¦æ—¶é—´æˆ³éªŒè¯ï¼‰
        CURRENT_TIME=$(date +"%Y-%m-%d %H:%M:%S")
        echo "å†™å…¥æ—¶é—´: $CURRENT_TIME"
        
        cat > data/stats.json << EOF
{
  "followers": 999,
  "likes": 777,
  "videos": 555,
  "lastUpdate": "$CURRENT_TIME",
  "status": "debug_test",
  "source": "debug_workflow"
}
EOF
        
        echo "å†™å…¥åæ–‡ä»¶å†…å®¹:"
        cat data/stats.json
        echo "=== å†™å…¥å®Œæˆ ==="
    
    - name: Verify and Commit
      run: |
        echo "=== éªŒè¯å’Œæäº¤ ==="
        git config user.email "action@github.com"
        git config user.name "GitHub Action"
        
        echo "æäº¤å‰æ–‡ä»¶çŠ¶æ€:"
        git status
        git diff data/stats.json || echo "æ— å·®å¼‚"
        
        git add data/stats.json
        git commit -m "ğŸ”§ DEBUG: æµ‹è¯•æ•°æ®å†™å…¥ - $(date +'%H:%M:%S')" || echo "æ— å˜åŒ–å¯æäº¤"
        git push
        echo "=== å®Œæˆ ==="
